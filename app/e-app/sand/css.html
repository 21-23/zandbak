<!DOCTYPE html>
<html>
<head>
    <script>
        (function() {
            var ipcRenderer = require('electron').ipcRenderer;

            function exec(task) {
                try {
                    var result = document.querySelectorAll(task.input);

                    return [result];
                } catch (e) {
                    return [null, e];
                }
            }

            ipcRenderer.on('wrk:>init', function (event, message) {
                ipcRenderer.send('wrk::created', { path: [] });
            });

            ipcRenderer.on('wrk:>fill', function (event, message) {
                document.body.innerHTML = message.content;
                message.content = undefined; // no need to transfer back the filler

                ipcRenderer.send('wrk::filled', message);
            });

            ipcRenderer.on('wrk:>exec', function (event, message) {
                var result = exec(message.task);

                if (result.length === 1) {
                    message.result = result[0];
                } else {
                    var e = result[1];
                    message.error = (e && e.message || (e + ''));
                }

                ipcRenderer.send('wrk::done', message);
            });
        })();
    </script>
</head>
<body>
</body>
</html>
